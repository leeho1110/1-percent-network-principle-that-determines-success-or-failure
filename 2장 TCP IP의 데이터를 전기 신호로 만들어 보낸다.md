# 2장: TCP/IP의 데이터를 전기 신호로 만들어 보낸다

### 1. 소켓을 작성한다

- 소켓을 생성하고 커넥션 연결을 담당하는 프로토콜 스택은 제어 정보를 위한 메모리 영역을 별도로 가지며, 제어 정보를 기록합니다.
    - 제어 정보는 통신 상대의 IP 주소, 포트 번호, 통신 동작의 진행 상태입니다.
    - 송신 동작 중에는 송신 이후 응답을 기다리는 동작도 포함됩니다. 응답이 돌아오지 않은 경우, 송신이 온전하지 않다고 판단 하에 재전송을 수행해야 합니다.
        - 이를 위해선 대기 시간이 필요하기에 소켓에는 응답 여부와 송신 후 경과 시간이 기록되어 있습니다.
- 애플리케이션은 `socket` 을 호출해 프로토콜 스택에 소켓 생성을 의뢰합니다.
    - 프로토콜 스택은 소켓의 제어 정보를 기록할 메모리 공간을 확보합니다.
    - 소켓별로 기록되는 정보가 다르기에 해당 요청에서는 소켓 1개 분량의 메모리만 준비합니다.
    - 소켓이 생성될 때 기록되는 정보는 초기 상태임을 나타냅니다.
    - 생성 시 반환되는 디스크립터를 애플리케이션에 전달합니다. 애플리케이션이 데이터 송수신을 위해 프로토콜 스택과 상호작용할 때 전달됩니다.
        - 디스크립터는 소켓의 제어 정보를 추상화합니다.

---

### 2. 서버에 접속한다

- 소켓을 생성하고 애플리케이션은 `connect` 를 호출해 TCP Connection을 생성합니다.
    - 소켓은 이더넷 혹은 무선 LAN 위에서 동작합니다. 이는 소켓에서 데이터를 송신하면 곧바로 케이블을 통해 데이터가 전송될 수 있다는 것을 의미합니다.
    - 하지만 소켓 생성 직후, 소켓은 프로토콜 스택에 ‘누구’와 데이터를 송수신할 것인지 먼저 알려야 합니다. 이를 **‘접속 동작’** 이라고 합니다.
    - 접속 동작의 첫 번째는 상대방과 제어 정보를 주고 받으며 송수신이 가능한 상태로 만드는 것입니다.
        - 이 때 송수신 데이터는 일시적으로 ‘버퍼 메모리’ 라는 메모리에 저장됩니다.
    - 접속 동작에서 주고 받는 제어 정보는 TCP 헤더를 의미합니다.
        - 우리가 생각하는 **SYN → SYN + ACK → ACK** 순서의 TCP 세그먼트의 헤더가 맞습니다. 정확하게는 컨트롤 비트가 SYN, SYN과 ACK, ACK로 매핑된 3개의 세그먼트입니다.
    - TCP 헤더 외에 제어 정보는 소켓에 기록되는 제어 정보는 상대편에서 볼 수 없습니다.

---